# This file is generated by the template.

REGISTRY	?=lcr.loongnix.cn
ORGANIZATION	?=CollaboraOnline
REPOSITORY	?=online
TAG		?=distro-collabora-co-22-05
LATEST		?=true

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)

LATEST_IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):latest

default: image
ci: src
	docker run --rm -v `pwd`:/build \
                -e https_proxy=${https_proxy} \
                -e http_proxy=${http_proxy} \
		ghcr.io/loong64/opencloudos:23-20250119 /bin/bash -c 'bash /build/ci.sh'
	
src:
	git clone --depth 1 -b distro/collabora/co-22-05 https://github.com/CollaboraOnline/online src && \
	cd src && git apply ../0001-add-loong64.patch
	#cd src && git apply ../add-loong64-support.patch

image: ci
	cd src/docker/from-source/ && bash docker-build.sh

push:
	docker push lcr.loongnix.cn/library/collaboraonline:22-05
