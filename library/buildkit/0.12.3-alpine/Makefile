# This file is generated by the template.

REGISTRY        ?=lcr.loongnix.cn
ORGANIZATION    ?=library
REPOSITORY      ?=buildkit
TAG             ?=0.12.3-alpine3.21
LATEST          ?=true

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)
LATEST_IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):latest
GIT_URL=https://github.com/Loongson-Cloud-Community/buildkit.git

default: image

src:
	git clone --depth 1 -b loong64-0.12.3-runc-1.3.0 $(GIT_URL) src

image: src
        cd src && make image
push: src
        cd src && make push
        docker tag lcr.loongnix.cn/library/buildkit:0.12.3-alpine3.21-runc-1.3.0 $(IMAGE)
        docker push $(IMAGE)
        docker tag $(IMAGE) $(LATEST_IMAGE)
        docker push $(LATEST_IMAGE)
clean:
	rm -rf src
