# This file is generated by the template.

REGISTRY        ?=lcr.loongnix.cn
ORGANIZATION    ?=library
REPOSITORY      ?=kafka
TAG             ?=2.6.0
LATEST          ?=false

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)
LATEST_IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):latest
default: image

image: bin JDK 
	docker build -t $(IMAGE) .
bin: kafka_2.13-2.6.0.tgz
	tar -vxf kafka_2.13-2.6.0.tgz
kafka_2.13-2.6.0.tgz :
	wget https://github.com/Loongson-Cloud-Community/kafka/releases/download/2.6.0/kafka_2.13-2.6.0.tgz
JDK: loongson8.1.23-fx-jdk8u452b09-linux-loongarch64-glibc2.34.tar.gz
	tar -vxf loongson8.1.23-fx-jdk8u452b09-linux-loongarch64-glibc2.34.tar.gz
loongson8.1.23-fx-jdk8u452b09-linux-loongarch64-glibc2.34.tar.gz:
	wget https://ftp.loongnix.cn/Java/openjdk8/loongson8.1.23-fx-jdk8u452b09-linux-loongarch64-glibc2.34.tar.gz
clean:
	rm -rf kafka_2.13-2.6.0.tgz kafka_2.13-2.6.0 loongson8.1.23-fx-jdk8u452b09-linux-loongarch64-glibc2.34.tar.gz jdk8u452-b09 
push:
	docker push $(IMAGE)
	#latest image
	@if [ $(LATEST) = "true" ]; \
                then \
                docker tag $(IMAGE) $(LATEST_IMAGE); \
                docker push $(LATEST_IMAGE); \
        fi

