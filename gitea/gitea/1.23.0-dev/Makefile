# This file is generated by the template.

REGISTRY	?=lcr.loongnix.cn
ORGANIZATION	?=gitea
REPOSITORY	?=gitea
TAG		?=1.23.0-dev
LATEST		?=true

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)
LATEST_IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):latest
GIT_URL=https://github.com/go-gitea/gitea

default: image

src: clean
	git clone -b v$(TAG) $(GIT_URL) $@ && \
		cd src && git apply ../0001-add-loong64.patch

image: src
	cd src && make docker

push:
	docker push $(LATEST_IMAGE)

clean:
	rm -rf src
