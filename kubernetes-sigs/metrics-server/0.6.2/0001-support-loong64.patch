From 34104ea1f00bfa52c630dd66656643c841606e5c Mon Sep 17 00:00:00 2001
From: liujie <liujie@loongson.cn>
Date: Tue, 20 May 2025 20:44:56 +0800
Subject: [PATCH] patch

---
 Dockerfile | 4 ++--
 Makefile   | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/Dockerfile b/Dockerfile
index a20e788a..17b203b3 100644
--- a/Dockerfile
+++ b/Dockerfile
@@ -1,7 +1,7 @@
 # Update the base image in Makefile when updating golang version. This has to
 # be pre-pulled in order to work on GCB.
 ARG ARCH
-FROM golang:1.17.13 as build
+FROM lcr.loongnix.cn/calico/go-build:0.73 as build
 
 WORKDIR /go/src/sigs.k8s.io/metrics-server
 COPY go.mod .
@@ -17,7 +17,7 @@ ARG GIT_COMMIT
 ARG GIT_TAG
 RUN make metrics-server
 
-FROM gcr.io/distroless/static:latest-$ARCH
+FROM scratch 
 COPY --from=build /go/src/sigs.k8s.io/metrics-server/metrics-server /
 USER 65534
 ENTRYPOINT ["/metrics-server"]
diff --git a/Makefile b/Makefile
index 0bf8cf52..8ef10373 100644
--- a/Makefile
+++ b/Makefile
@@ -44,7 +44,7 @@ CONTAINER_ARCH_TARGETS=$(addprefix container-,$(ALL_ARCHITECTURES))
 container:
 	# Pull base image explicitly. Keep in sync with Dockerfile, otherwise
 	# GCB builds will start failing.
-	docker pull golang:1.17.13
+	docker pull lcr.loongnix.cn/calico/go-build:0.73
 	docker build -t $(REGISTRY)/metrics-server-$(ARCH):$(CHECKSUM) --build-arg ARCH=$(ARCH) --build-arg GIT_TAG=$(GIT_TAG) --build-arg GIT_COMMIT=$(GIT_COMMIT) .
 
 .PHONY: container-all
-- 
2.41.0

