"use strict";(self.webpackChunkkubesphere_console=self.webpackChunkkubesphere_console||[]).push([[113],{28113:function(e,r,n){n.r(r),n.d(r,{default:function(){return s}});var t=n(96540),u=n(2543),o=n(62975),i=n(29195),l=n(81995),c=n(72746);var s=(0,t.forwardRef)(function({websocketUrl:e,terminalOptions:r,initText:n=c.Eg.initText,isEdgeNode:s=c.Eg.isEdgeNode},d){const v=(0,u.merge)({},c.Sv,r),a=(0,t.useRef)(null),f=(0,t.useRef)(),w=(0,t.useRef)(),p=(0,t.useRef)(),m=(0,t.useRef)(!0),E=(0,t.useRef)(null),b=(0,t.useRef)(null),g=()=>{var e,r;return(null===(r=null===(e=p.current)||void 0===e?void 0:e.client)||void 0===r?void 0:r.readyState)===WebSocket.OPEN},R=()=>{E.current&&window.clearInterval(E.current)},h=()=>{b.current&&window.clearInterval(b.current)},k=(e=!0)=>{var r;const n=null===(r=f.current)||void 0===r?void 0:r.textarea;n&&(n.disabled=e)},y=()=>{var e,r,n;const t=null===(e=f.current)||void 0===e?void 0:e.cols,u=null===(r=f.current)||void 0===r?void 0:r.rows;if(g()&&"number"==typeof u&&"number"==typeof t){const e=function({cols:e,rows:r}){return JSON.stringify({Op:"resize",Cols:e,Rows:r})}({cols:t,rows:u});null===(n=p.current)||void 0===n||n.send(e)}},N=e=>{var r,n,t;R(),m.current&&(m.current=!1,k(!1),null===(r=f.current)||void 0===r||r.reset(),(null===(n=f.current)||void 0===n?void 0:n.element)&&f.current.focus(),y()),null===(t=f.current)||void 0===t||t.write(e.Data)},I=e=>{R(),(e=>{var r,n;const t=m.current;let u="";!e&&t?u=`Could not connect to the ${s?"node":"container"}. Do you have sufficient privileges?`:e?t?t&&(null===(r=f.current)||void 0===r||r.reset()):u=`\r\n${e}`:u="disconnected",null===(n=f.current)||void 0===n||n.write(`[31m${u}[m\r\n`)})(e.message)},O=()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.fit()},S=(0,u.debounce)(O,800),z=e=>{var r;if(g()){const n=function(e){return JSON.stringify({Op:"stdin",Data:e})}(e);null===(r=p.current)||void 0===r||r.send(n)}},T=()=>{var e;k(),null===(e=p.current)||void 0===e||e.close(!0)};return(0,t.useImperativeHandle)(d,()=>({resizeTerminal:S}),[]),(0,t.useEffect)(()=>{var e,r;return f.current=new o.Terminal(v),w.current=new i.FitAddon,null===(e=f.current)||void 0===e||e.loadAddon(w.current),a.current&&(f.current.open(a.current),E.current=(()=>{let e=0;return window.setInterval(()=>{var r,t;null===(r=f.current)||void 0===r||r.reset(),null===(t=f.current)||void 0===t||t.write(`${n}${".".repeat(++e)}`),e>2&&(e=0)},500)})(),O(),(()=>{var e;window.addEventListener("resize",S),null===(e=f.current)||void 0===e||e.onResize(y)})(),null===(r=f.current)||void 0===r||r.onData(z),k(),b.current=window.setInterval(()=>{var e,r;const n=null===(e=f.current)||void 0===e?void 0:e.cols;O();const t=null===(r=f.current)||void 0===r?void 0:r.cols;"number"==typeof t&&n===t&&h()},100)),()=>{var e;null===(e=f.current)||void 0===e||e.dispose(),T(),window.removeEventListener("resize",S),R(),h()}},[]),(0,t.useEffect)(()=>{var r;return p.current&&(null===(r=p.current)||void 0===r||r.close(!0)),p.current=new l.r(e,{onMessage:N,onError:I,reopenLimit:Number.MAX_SAFE_INTEGER}),()=>T()},[e]),t.createElement("div",{ref:a,style:{width:"100%",height:"100%"}})})}}]);