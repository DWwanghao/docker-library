# This file is generated by the template.

REGISTRY	?=lcr.loongnix.cn
ORGANIZATION	?=sonatype
REPOSITORY	?=nexus
TAG		?=2.15.1
LATEST		?=true

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)
LATEST_IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):latest

default: image

src: clean
	git clone --depth 1 -b 2.15.1 https://github.com/sonatype/docker-nexus && \
		cd docker-nexus && git apply ../0001-add-loong64-port.patch

image: src oss pro

.PHONY: oss pro
oss:
	cd docker-nexus && docker build  --build-arg https_proxy=$(https_proxy) --rm --tag lcr.loongnix.cn/sonatype/nexus:2.15.1-02 oss/

pro:
	cd docker-nexus && docker build  --build-arg https_proxy=$(https_proxy) --rm --tag lcr.loongnix.cn/sonatype/nexus-pro:2.15.1-02 pro/

push:
	docker push lcr.loongnix.cn/sonatype/nexus-pro:2.15.1-02 && docker push lcr.loongnix.cn/sonatype/nexus:2.15.1-02

clean:
	rm -rf docker-nexus
